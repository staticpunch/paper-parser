## A human liver cell atlas reveals heterogeneity and epithelial progenitors

The human liver is an essential multifunctional organ. The incidence of liver diseases is rising and there are limited treatment options. However, the cellular composition of the liver remains poorly understood. Here we performed single-cell RNA sequencing of about 10,000 cells from normal liver tissue from nine human donors to construct a human liver cell atlas. Our analysis identified previously unknown subtypes of endothelial cells, Kupffer cells, and hepatocytes, with transcriptome-wide zonation of some of these populations. We show that the EPCAM + population is heterogeneous, comprising hepatocyte-biased and cholangiocyte populations as well as a TROP2 int  progenitor population with strong potential to form bipotent liver organoids. As a proof-of-principle, we used our atlas to unravel the phenotypic changes that occur in hepatocellular carcinoma cells and in human hepatocytes and liver endothelial cells engrafted into a mouse liver. Our human liver cell atlas provides a powerful resource to enable the discovery of previously unknown cell types in normal and diseased livers.

The liver serves as a central metabolic coordinator with a wide array of essential functions, including the regulation of glucose and lipid metabolism, protein synthesis, and bile synthesis. Furthermore, the liver is a visceral organ that is capable of remarkable natural regeneration after tissue loss 1 . However, the prevalence of liver diseases and mortality associated with them have risen markedly within recent decades 2 . The liver cellular landscape has barely been explored at single-cell resolution, which limits our molecular understanding of liver function and disease biology. The recent emergence of sensitive single-cell RNA sequencing (scRNA-seq) methods 3 allows us to investigate cell types in healthy and diseased tissue.

To characterize the human liver at single-cell resolution, we developed a robust pipeline for scRNA-seq of cryopreserved and freshly isolated samples of patient-derived human liver and assembled an atlas consisting of 10,372 cells from nine donors. We performed in-depth analysis of all liver cell types with a focus on epithelial liver cell progenitors.

## scRNA-seq of the human liver

We used mCEL-Seq2 4  for scRNA-seq of non-diseased liver tissue from nine patients who underwent liver resections for colorectal cancer metastasis or cholangiocarcinoma without history of chronic liver disease (Fig. 1a, see Methods). We sorted and sequenced viable cells both in an unbiased fashion and by enriching specific cell populations on the basis of cell surface marker expression (Extended Data Fig. 1, see Methods). Because fresh liver tissue material is scarce and difficult to preserve, and biobanks with cryopreserved liver samples represent rich resources, we generated scRNA-seq data from cryopreserved cells as well as single-cell suspensions from freshly prepared liver samples (see Methods). We then used RaceID3 for the identification of cell types 4,5 (see Methods).

Cells from different patients, isolated from freshly prepared or cryopreserved single-cell suspensions, co-clustered (Extended Data Fig. 1).

Furthermore, fresh and cryopreserved cells from the same patient did not have markedly different gene signatures (Extended Data Fig. 1e-h). However, there were compositional differences both between fresh and cryopreserved samples derived from the same patient and among different fresh (or cryopreserved) samples. We attribute these differences to variability in cell viability and cell type composition across samples.

As scRNA-seq of randomly sampled populations yielded almost exclusively hepatocytes and immune cells (Extended Data Fig. 1i), we applied additional sorting strategies to enrich for endothelial cells (Extended Data Fig. 1a-c) and EPCAM + cells (see below).

Our atlas comprises all the main liver cell types defined by the expression of marker genes, including hepatocytes, EPCAM + bile duct cells (cholangiocytes), CLEC4G + liver sinusoidal endothelial cells (LSECs), CD34 + PECAM high  macrovascular endothelial cells (MaVECs), hepatic stellate cells and myofibroblasts, Kupffer cells, and immune cells (Fig. 1b-d, Supplementary Table 1). To facilitate interactive exploration of our human liver cell atlas, we created a web interface: http://human-liver-cell-atlas.ie-freiburg.mpg.de/.

## Zonation of human liver cell types

Hepatocytes are spatially heterogeneous and zonated along the portal-central axis of the liver lobule 6-8 . According to metabolic subspecialization, the liver lobule has been divided into the periportal zone surrounding the portal triad (portal vein, hepatic artery and bile duct), the central zone nearest to the central vein, and the remaining mid zone 6-8 . Whereas previous observations have suggested that nonparenchymal cells such as LSECs and Kupffer cells have specialized subtypes 6 types, and most studies have been carried out in rodents.

We were able to directly compare the signatures of MaVECs and LSECs, and identified several previously unknown subpopulations (Extended Data Fig. 2, Supplementary Note 1).

scRNA-seq has been highly informative on hepatocyte zonation in mouse 9 , and the first single-cell analysis of human hepatocyte and endothelial cell zonation at limited resolution was done recently 10 . To infer continuous transcriptome-wide zonation, we reasoned that the major axis of variability for a cell type could reflect gene expression changes associated with zonation. Hence, we ordered LSECs and hepatocytes by diffusion pseudo-time (dpt) 11 , here interpreted as pseudo-space, along this axis and applied self-organizing maps (SOMs) to infer co-expression modules (Fig. 2, see Methods).

We first validated our strategy by recovering the previously characterized zonation of mouse hepatocytes 9 (Extended Data Fig. 3a-d). For our human hepatocytes, this approach recovered zonated expression patterns of landmark genes: for example, ALB and PCK1 (periportal module 1), CYP1A2 and CYP2E1 (central/midzonal modules 34 and 24, respectively), and GLUL (central module 33) 7,9 (Fig. 2a, Extended Data Fig. 3e-g, Supplementary Tables 2, 3). In total, 1,384 out of 3,395 expressed genes (41%) included in the hepatocyte analysis exhibited significant zonation (Benjamini-Hochberg corrected ANOVA, P &lt; 0.01). Pathway enrichment analysis revealed that periportal hepatocyte modules are enriched in genes involved in biological oxidation, consistent with an oxygen gradient that peaks in the periportal zone 6-8 , and in the glycogen synthesis pathway (Extended Data Fig. 3h). In accordance with its zonation in mouse hepatocytes, the urea cycle enzyme CPS1 peaks in periportal hepatocytes (Extended Data Fig. 3g). Midzonal hepatocyte modules are enriched in, for example, metabolism

LYVE1 and CD14 have been identified as markers that distinguish midzonal and central LSECs from periportal LSECs 12 . Analysis of LSEC zonation showed that 806 out of 1,198 expressed genes (67%) exhibited significant zonation (Benjamini-Hochberg corrected ANOVA, P &lt; 0.01) (Fig. 2b, Extended Data Fig. 3i, Supplementary Tables 4, 5). Central and midzonal endothelial cells (modules 1 and 3) exhibited peaked expression of LYVE1 and FCN3 , which encodes a ficolin protein that can switch on the lectin pathway of complement activation. Notably, pathway enrichment analysis of the central and midzonal endothelial modules recovered pathways, such as binding and uptake of ligands by scavenger receptors, that are shared with midzonal hepatocytes (Extended Data Fig. 3j). Together with a more detailed gene expression analysis (Supplementary Note 2) this observation suggests that genes and functions are co-zonated across hepatocytes and endothelial cells.

Finally, a comparison between mouse 9,13 and human cells revealed only limited evolutionary conservation of gene expression zonation (Supplementary Note 3, Extended Data Fig. 3k, l, Supplementary Tables 6, 7), reflecting widespread evolutionary changes.

## Human liver immune cell populations

A detailed analysis of the CD163 + VSIG4 + Kupffer cell compartment revealed subpopulations with distinct gene expression signatures (Supplementary Note 4, Extended Data Fig. 4), in agreement with a recent study 10 . Moreover, we detected shared gene expression and pathways between Kupffer cell subsets and endothelial cells (Supplementary Note 4, Extended Data Fig. 4), providing further evidence that different cell types show functional co-operation.

We identified an MS4A1 + CD37 + subset of B cells, which corresponds to circulating B cells with upregulated MHC class II components, and a liver-resident MZB1 + subset of B cells that expresses DERL3 , SSR4 and IGHG4 (Extended Data Fig. 5).

Finally, we recovered a population of CD56 + (also known as NCAM1 + ) natural killer (NK) cells (cluster 5), as well as CD56 -(cluster 3) and CD56 + (cluster 1) CD8A + NKT cells, which expressed different combinations of chemokine ligands, granzymes, and killer cell lectin-like receptor genes (Extended Data Fig. 6). In clusters 12 and 18, a number of heat-shock genes are upregulated. These observations demonstrate an unexpected variety of immune cell subtypes in the human liver.

## Putative bipotent epithelial progenitors

Liver regeneration after tissue damage involves the replication of several types of liver cells, including hepatocytes and cholangiocytes. Furthermore, different types of liver damage lead to specific mechanisms of liver regeneration 14,15 . However, the existence of a population of naive adult stem cells in the human liver and its contribution to turnover and regeneration remains controversial. Rare EPCAM + cells have been termed hepatic stem cells 16 ; these can form dense round colonies when cultured and are bipotent progenitors of hepatoblasts, which differentiate into cholangiocytes or hepatocytes both in vitro and in vivo 16,17 .

To search for genuine liver progenitor cells, we sorted and sequenced single EPCAM + cells from adult human livers. We identified biliary and potential liver progenitor cell surface marker genes that correlated with EPCAM or TROP1 expression; these included TACSTD2 (also known as TROP2 ), FGFR2 , TM4SF4 and CLDN1 . Immunohistochemistry confirmed the expression of predicted markers such as ANXA4 and the transcriptional co-activator WWTR1 (Extended Data Fig. 7a).

A focused analysis revealed that the EPCAM + compartment is transcriptionally heterogeneous and consists of an ASGR1 + hepatocytebiased population, KRT19 high CFTR high ALB low cholangiocyte populations, and a remaining population of putative naive progenitor cells (Fig. 3a, Extended Data Fig. 7b, c). The EPCAM + population exhibits only stochastic expression of the proliferation markers MKI67 and

PCNA and is negative for the hepatoblast marker AFP (Extended Data Fig. 7d). Hence, the transcriptional heterogeneity of this population is unlikely to arise as a result of proliferation, and the observed subtypes reside in the normal human liver.

To explore the relatedness of these subpopulations, we reanalysed the EPCAM + population with RaceID3 and used StemID2 for lineage reconstruction 4,18 (Fig. 3b, see Methods). This analysis showed that the population in the centre of the t -distributed stochastic neighbour embedding ( t -SNE) map (clusters 1, 2, 5, 6, 7) bifurcates into hepatocyte progenitors and cholangiocytes. To provide further evidence for continuous differentiation trajectories connecting naive EPCAM + progenitors to cholangiocytes and mature hepatocytes, we performed StemID2 and diffusion map analyses on the combined population of mature hepatocytes and EPCAM + cells (Extended Data Fig. 8a-c).

To better understand the emergence of fate bias towards the two lineages, we used FateID to infer lineage probabilities in each cell 4 . Consistently, FateID inferred similar probabilities that the central population would differentiate towards hepatocytes and cholangiocytes (Fig. 3c). The fate bias predictions are supported by a differential gene expression analysis revealing upregulation of common genes that encode several signalling pathway components ( HES1 , SFRP5 , FGFR2 , FGFR3 ) in the central population (Fig. 3d), and gradual upregulation of distinct gene sets towards the hepatocyte-biased and cholangiocyte populations (Extended Data Fig. 8e). The expression of TROP2 was negatively correlated with hepatocyte fate bias, exhibiting a gradient that ranged from high expression in mature cholangiocytes to very low expression in the hepatocyte-biased population (Fig. 3e, Extended Data Fig. 7c). Immunostaining for TROP2 in normal human liver tissue showed specific expression in cells of the bile ducts and bile ductules (Fig. 3f). Notably, TROP2 expression has been found in amplifying oval cells in injured mouse livers 19 .

The central TROP2 int population is in itself heterogeneous and contains a MUC6 high population (cluster 7) (Extended Data Fig. 7c). MUC6 is highly expressed by pancreatic progenitors and multi-potent bile duct tree stem cells 20 , which have been proposed to be the origin of the EPCAM + hepatic stem cells. The TROP2 high cholangiocyte clusters comprise a CXCL8 + population (cluster 8) and an MMP7 + population (clusters 4 and 13) (Extended Data Figs. 7c, 8e, f), whereas TROP2 low clusters show upregulation of hepatocyte markers such as ALB , HP , HNF4A and ASGR1 (Fig. 3d, Extended Data Figs. 7c, 8e, f).

The central TROP2 int population that was stratified as bipotent on the basis of FateID-predicted bias expresses genes that encode early developmental transcription factors such as HES1, which is essential for tubular bile duct formation 21 , and PROX1, an early specification marker for the developing liver in the mammalian foregut endoderm that is required for hepatocyte proliferation and migration during development 22 (Fig. 3d). Furthermore, this population showed lower expression of hepatocyte genes such as HNF4A , HP and ALB and of cholangiocyte genes such as KRT19 and CFTR compared to the hepatocyte-biased and mature cholangiocyte populations, respectively (Fig. 3d, Extended Data Figs. 7c, 8f). We speculate that we enriched for the TROP2 int KRT19 low/immature population during cell isolation, as mature bile duct cells require a harsher digestion for their isolation, which can negatively affect other liver cell types. Thus, the actual fraction of KRT19 high cells in the tissue is presumably higher. We validated the existence of EPCAM + KRT19 low/cells in addition to EPCAM + KRT19 high/ + cells in situ by immunofluorescence (Fig. 3g, Extended Data Fig. 7e).

Consistent with our scRNA-seq data, flow cytometry profiles of EPCAM and TROP2 displayed a gradient of TROP2 expression in EPCAM + cells, and EPCAM expression correlated with TROP2 expression (Fig. 4a). Moreover, forward and side-scatter profiles of EPCAM + cells indicated that the compartment is heterogeneous and consists of populations with different sizes and morphologies (Fig. 4a). On the basis of the distribution of TROP2 expression, we compartmentalized EPCAM + cells into three compartments: TROP2 low/, TROP2 int , and TROP2 high (Fig. 4a). To confirm that the TROP2 int population harbours the progenitor population, we attempted to culture bipotent organoids 23 from each compartment. In agreement with our prediction, TROP2 int cells exhibited the highest organoid-forming capacity, whereas TROP2 low/cells did not form organoids, and TROP2 high cells gave rise to much smaller organoids at a strongly reduced frequency compared to TROP2 int cells (Fig. 4b). Single-cell culture of TROP2 int cells demonstrated the organoid-forming capacity of individual cells from this gate, providing evidence for bipotency at the clonal level (Fig. 4c). As expected, scRNA-seq of the input populations for organoid culture from each compartment showed a marked enrichment of the respective compartment in the original EPCAM + data (Fig. 4d, e, Extended Data Fig. 8g, h). Notably, flow cytometry profiles of EPCAM and TROP2 for organoid cells grown from the TROP2 int  compartment recovered TROP2 low/, TROP2 int and TROP2 high populations in the organoids (Fig. 4f).

To elucidate the cell type composition of the organoids in depth, we performed scRNA-seq. Co-analysis of organoid cells and EPCAM + cells sequenced directly from patients demonstrated marked transcriptome differences (Fig. 4e). Although EPCAM and CD24 were expressed in cells from both organoids and patients, organoid cells showed lower expression of various genes such as AQP1 and the WNT signalling modulator SFRP5 , and higher expression of others, such as the proliferation marker MKI67 + , reflected by differential enrichment of the corresponding pathways (Fig. 4g, Extended Data Fig. 8i-k). We observed several subpopulations within the organoids, including a non-dividing hepatocyte-biased SERPINA1 high population and a non-dividing KRT19 high cholangiocyte-biased population, consistent with the signature of the EPCAM + cells recovered from the patients (Fig. 4e). This further supports the claim that the TROP2 int compartment harbours a bipotent progenitor population, which can give rise to hepatocyte and cholangiocyte populations.

In contrast to patient cells, organoid cells showed strong downregulation of ALB but expressed AGR2 and other mucin family genes such as MUC5AC and MUC5B , which are normally expressed, for example, in intestinal cells and gastrointestinal cancers 24,25 (Fig. 4g, Extended Data Fig. 8j). These observations reflect that organoid cells express genes that are expressed in other systems, acquire a more proliferative state, and appear to upregulate stem cell-related pathways such as WNT signalling.

In light of these functional validation experiments, the observed gene signature of TROP2 int cells, and the in situ location of these cells, our data strongly suggest that the putative liver progenitor population can be defined as a subpopulation of bile duct cells.

## Perturbed cell states in liver cancer

Hepatocellular carcinoma (HCC) is the most common type of primary liver cancer 26 . To demonstrate the value of our atlas as a reference for comparisons with diseased liver cells, we sequenced CD45 + and CD45 cells from HCC tissue from three patients (Extended Data Fig. 9a, b, see Methods).

We recovered several cell types from the tumours, including cancer cells, endothelial cells, Kupffer cells, NKT cells and NK cells (Fig. 5a, Extended Data Fig. 9c) and compared them to the normal liver cell atlas. Differential gene expression analysis and immunohistochemistry revealed that cancer cells lose the expression of cytochrome P450 genes such as CYP2E1 and CYP2C8 and the periportally zonated gene CPS1 (Fig. 5b, Extended Data Fig. 9d, e) as well as the metabolic signature of normal hepatocytes (Fig. 5c). They show increased expression of AKR1B10 , a known biomarker of HCC with potential involvement in hepatocellular carcinogenesis 27 (Extended Data Fig. 9d). Moreover, immunohistochemistry confirmed that IL32, a pro-inflammatory TNF α -inducing cytokine, is highly upregulated in cancer cells (Fig. 5b). Overall, cancer cells show upregulation of WNT and Hedgehog signalling pathways, highlighting similarities between EPCAM + normal liver progenitors and the observed cancer cell population (Fig. 5c).

Endothelial cells from tumours show upregulation of, for example, extracellular matrix organization genes such as COL4A2 and SPARC (Fig. 5d, Extended Data Fig. 9f). Strikingly, they do not express LSEC marker genes such as CLEC4G but do express MaVEC marker genes such as PECAM1 , AQP1 and CD34 (Fig. 5e, Extended Data Fig. 9f, g). Moreover, HCC LSECs show increased expression of PLVAP, which makes them less permeable and could potentially restrict the access of lymphocytes and soluble antigens 28 to the tumour (Supplementary Note 5, Extended Data Fig. 9f, g).

We conclude that the comparison of scRNA-seq data between the cell populations of HCC and the liver cell atlas allows the inference of perturbed gene expression signatures, biomarkers and modulated functions across cell types.

## A human liver chimaeric mouse model

Mice harbouring patient-derived xenografted liver cells are a powerful tool for studying human liver cells and diseases in vivo 29 . To correctly interpret such experiments, it is crucial to understand the differences between cells taken directly from the human liver and human cells that have been transplanted into the mouse liver.

To address this issue, we transplanted human liver cells from patient-derived hepatocyte and non-parenchymal cell fractions into FRG-NOD ( Fah -/ -Rag2 -/ -Il2rg -/ -non-obese diabetic)  mice 30 (HMouse); after engraftment, we sorted single human cells in an unbiased fashion and on the basis of hepatocyte and endothelial cell markers for scRNA-seq (Fig. 6a, Extended Data Fig. 10a). We then compared engrafted cells to our reference atlas and observed that we had successfully transplanted both human hepatocytes and endothelial cells (Fig. 6b, Extended Data Fig. 10b, c), which had maintained their fundamental gene signatures, such as expression of ALB or PCK1 and CLEC4G , PECAM1 or CD34 , respectively (Extended Data Fig. 10b-f). Nevertheless, many genes were differentially expressed in engrafted cells compared to non-engrafted human liver cells; for example, AKR1B10 , which was also expressed by cancer cells from HCC, was expressed in engrafted cells but not non-engrafted cells (Fig. 6c, Extended Data Fig. 10g). Gene set enrichment analysis (GSEA) of differentially expressed genes revealed that HMouse hepatocytes and endothelial cells showed downregulation of pathways such as haemostasis, and upregulation of WNT and Hedgehog signalling as well as cell cycle genes (Fig. 6d), akin to what we observed in HCC cells and cells from liver organoids.

## Discussion

We have established a human liver cell atlas, revealing heterogeneity within major liver cell populations and the existence of an epithelial progenitor in the adult human liver.

Our atlas reveals transcriptome-wide zonation of hepatocytes and endothelial cells, and suggests that different liver cell types may cooperate to carry out essential functions. Although we could validate predicted zonation profiles with antibody staining, it will be essential to perform more large scale in situ gene expression analysis.

The EPCAM + TROP2 int population is a strong candidate for potential involvement in homeostatic turnover, liver regeneration, disease pathogenesis and tumour formation. Although our in silico analysis and in vitro organoid culture experiments provide evidence that this

As demonstrated by our HCC analysis, the atlas provides a key reference for the investigation of liver diseases and will contribute to the development of urgently needed human liver models, including organoids and humanized liver chimaeric mouse models.

## Online content

Any methods, additional references, Nature Research reporting summaries, source data, extended data, supplementary information, acknowledgements, peer review information; details of author contributions and competing interests; and statements of data and code availability are available at https://doi.org/10.1038/s41586019-1373-2.

Publisher's note: Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.

## Methods

Human liver samples. Human liver tissue samples were obtained from patients who had undergone liver resections between 2014 and 2018 at the Center for Digestive and Liver Disease (Pôle Hépato-digestif) at the Strasbourg University Hospitals, University of Strasbourg, France. For the human liver cell atlas, samples were acquired from patients without chronic liver disease (defined as liver damage lasting over a period of at least six months), genetic haemochromatosis with homozygote C282Y mutation, active alcohol consumption ( &gt; 20 g/d in women and &gt; 30 g/d in men), active infectious disease, pregnancy or any contraindication for liver resection. All patients provided written informed consent. The protocols followed the ethical principles of the declaration of Helsinki and were approved by the local Ethics Committee of the University of Strasbourg Hospitals and by the French Ministry of Education and Research (CPP 10-17, Ministère de l'Education Nationale, de l'Enseignement Supérieur et de la Recherche; approval number DC-2016-2616). Data protection was performed according to EU legislation regarding privacy and confidentiality during personal data collection and processing (Directive 95/46/EC of the European Parliament and of the Council of the 24 October 1995). Samples (BP1) and tissue blocks were obtained from Biopredic International.

Tissue dissociation and preparation of single-cell suspensions. Human liver specimens obtained from resections were perfused for 15 min with calcium-free 4-(2-hydroxyethyl)-1-piperazine ethanesulfonic acid buffer containing 0.5 mM ethylene glycol tetraacetic acid (Fluka) followed by perfusion with 4-(2-hydroxyethyl)-1-piperazine ethanesulfonic acid containing 0.5 mg/ml collagenase (SigmaAldrich) and 0.075% CaCl2 at 37 °C for 15 min as previously described 32 . Then the cells were washed with phosphate-buffered saline (PBS) and nonviable cells were removed by Percoll (Sigma-Aldrich) gradient centrifugation. Part of the isolated cells was further separated into primary human hepatocytes (PHHs) and nonparenchymal cells (NPCs) by an additional centrifugation step at 50 g for 5 min at 4 °C. The isolated cells were frozen in liquid nitrogen using the CryoStor CS10 solution (Sigma-Aldrich). Human HCC tissues were dissociated using the gentleMACS Dissociator (Miltenyi Biotec) according to the manufacturer's protocol. Transplantation of human cells into Fah -/ -/Rag2 -/ -/Il2rg -/ -mice. Fah -/ -/ Rag2 -/ -/Il2rg -/ -non-obese diabetic (FRG-NOD) breeding mice were kept at the Inserm Unit 1110 SPF animal facility and maintained with 16 mg/l of 2-(2-nitro-4-trifluoro-methyl-benzoyl)-1,3 cyclohexanedione (NTBC; Swedish Orphan Biovitrum) in drinking water. Six-week-old male and female mice were intravenously injected with 1.5 × 10 9 plaque-forming units (pfu) of an adenoviral vector encoding the secreted form of the human urokinase-like plasminogen activator (Ad-uPA) 33 . Forty-eight hours later, 10 6  PHHs and 2 × 10 5  NPCs from the same liver donor, isolated as previously described, were injected intrasplenically via a 27-gauge needle. For the procedure, mice were kept under gaseous isoflurane anaesthesia and received a subcutaneous injection of buprenorphine (0.1 mg/kg). After transplantation, the NTBC was gradually decreased and completely withdrawn in 7 days. The success of the transplantation was evaluated 2 months after the procedure by dosing human albumin in mouse serum as previously described 34 . This procedure was approved by the local ethics committee and authorized by the French ministry of higher education and research (authorization number #4485-20l603lll5352125 v3). All procedures are consistent with the guidelines set by the Panel on Euthanasia (AVMA) and the NIH Guide for the Care and Use of Laboratory Animals as well as the Declaration of Helsinki in its latest version, and the Convention of the Council of Europe on Human Rights and Biomedicine. The animal research was performed within the regulations and conventions protecting animals used for research purposes (Directive 86/609/EEC), as well as with European and national laws regarding work with genetically modified organs. The animal facility at the University of Strasbourg, Inserm U1110 has been approved by the regional government (Préfecture) and granted authorization number E67-482-7, 2017/08/24.

Mouse liver cell isolation. The anaesthetized animal was restrained and the skin sprayed with 70% ethanol. The liver and other inner organs were revealed by cutting through the skin and peritoneum. A 24G needle was carefully inserted into the inferior vena cava and secured with a clamp, and chelating solution (0.05 M HEPES pH 7.2, 10 mM EGTA in HBSS without CaCl2 and MgCl2) was run at a low speed (1.5-2 ml/min). The portal vein was then cut and perfusion speed was increased to a flow rate of 7 ml/min. After that, the diaphragm was cut and the anterior vena cava clamped. The chelating perfusion was run for 7 min and then switched to collagenase solution (0.05 M HEPES pH 7.2, 4.7 mM CaCl2, 20 µ g/ml Liberase, Sigma LIBTM-RO) at a flow rate of 7 ml/min for 7 min. The liver was then removed and passed through a 70µ m cell strainer with 10 ml ice-cold PBS without CaCl2 and MgCl2. The resulting single-cell suspension was centrifuged at 300 g for 5 min at 4 °C and washed twice with ice-cold PBS.

FACS. Liver cells were sorted from mixed, hepatocyte, and non-parenchymal cell fractions on an Aria Fusion I using a 100µ m nozzle. Cells from the HCC samples were not fractionated and were sorted directly after tissue digestion. Zombie Green

(Biolegend) was used as a viability dye. Cells were stained with human-specific antibodies against CD45 (Biolegend, cat. no. 304023), PECAM1 (Biolegend, cat. no. 303111), CD34 (Biolegend, cat. no. 343609), CLEC4G (R&amp;D systems, cat. no. FAB2947A), ASGR1 (BD Biosciences, cat. no. 563655), EPCAM (R&amp;D systems, cat. no. FAB960R), and TROP2 (Biolegend, cat. no. 363803). Organoids were stained with antibodies against EPCAM and TROP2. For the humanized mouse samples, cells were stained either with antibodies against ASGR1 and PECAM1 or with human HLA-ABC (BD Biosciences, cat. no. 740407) and mouse H2-Kb (BD Biosciences, cat. no. 553570). Viable cells were sorted in an unbiased fashion or from specific populations based on the expression of markers into the wells of 384-well plates containing lysis buffer.

Single-cell RNA amplification and library preparation. Single-cell RNA sequencing was performed according to the mCEL-Seq2 protocol 4,35 . Viable liver cells were sorted into 384-well plates containing 240 nl primer mix and 1.2 µ l PCR encapsulation barrier, Vapour-Lock (QIAGEN) or mineral oil (Sigma-Aldrich). Sorted plates were centrifuged at 2,200 g for a few minutes at 4 °C, snap-frozen in liquid nitrogen and stored at -80 °C until they were processed. We used 160 nl reverse transcription reaction mix and 2.2 µ l second-strand reaction mix to convert RNA into cDNA. cDNA from 96 cells was pooled together before clean up and in vitro transcription, generating four libraries from one 384-well plate. We used 0.8 µ l AMPure/RNAClean XP beads (Beckman Coulter) per 1 µ l sample during all purification steps including library cleanup. Other steps were performed as described in the protocol 4,35 . Libraries were sequenced on an Illumina HiSeq 2500 and 3000 sequencing system (paired-end multiplexing run, high output mode) at a depth of ~150,000-200,000 reads per cell.

Quantification of transcript abundance. Paired-end reads were aligned to the transcriptome using bwa (version 0.6.2-r126) with default parameters 36 . The transcriptome contained all gene models based on the human whole genome ENCODE V24 release. All isoforms of the same gene were merged to a single gene locus. Subsequently, gene loci with &gt; 75% sequence overlap were merged. The right mate of each read pair was mapped to the ensemble of all gene loci and to the set of 92 ERCC spike-ins in the sense direction. Reads mapping to multiple loci were discarded. The left read contains the barcode information: the first six bases corresponded to the unique molecular identifier (UMI) followed by six bases representing the cell-specific barcode. The remainder of the left read contains a polyT stretch. The left read was not used for quantification. For each cell barcode, the number of UMIs per transcript was counted and aggregated across all transcripts derived from the same gene locus. The number of observed UMIs was converted into transcript counts using binomial statistics 37 .

Conservation of zonation between human and mouse. Expression data from Halpern et al. 9 (GEO accession code GSE84498) were used for analysing the evolutionary conservation of hepatocyte zonation between human and mouse. The transcript count data were analysed using RaceID3 to determine cell types, with parameter mintotal = 1,000 and cln = 6. A subgroup of clusters was identified as hepatocytes on the basis of marker gene expression and used for dpt and SOM

analysis, as was done for the human data. To obtain a similar number of genes, only genes with at least 1.5 counts after size normalization in at least a single cell were included. To identify orthologues between human and mouse for the references used in this study and by Halpern et al. 9 as provided by the authors, we first identified pairs of orthologues based on identical gene identifiers upon capitalization of all letters. We further computed mutual blastn (run with default) best hits. The final list comprises 16,670 pairs of orthologues.

Lineage analysis of the EPCAM + compartment. For a separate analysis of the EPCAM + population, all cells from clusters 4, 7, 24 and 39 were extracted and reanalysed using RaceID3 4 with the parameters mintotal = 1000 and minexpr = 2, minnumber = 10 outminc = 2, and default parameters otherwise. StemID2 4 was run on these clusters with cthr = 10, nmode = TRUE and knn = 3. FateID 4 was run on the filtered and feature-selected expression matrix from RaceID3, with target clusters inferred by FateID using ASGR1 plus ALB and CXCL8 plus MMP7 as markers for hepatocyte and cholangiocyte lineage target clusters, respectively. Using KRT19 and CFTR as mature cholangiocyte markers yields highly similar results.

Differential gene expression analysis. Differential gene expression analysis between cells and clusters was performed using the diffexpnb function from the RaceID package. First, negative binomial distributions reflecting the gene expression variability within each subgroup were inferred on the basis of the background model for the expected transcript count variability computed by RaceID3. Using these distributions, a P value for the observed difference in transcript counts between the two subgroups was calculated and corrected for multiple testing using the Benjamini-Hochberg method as described 38 .

Pathway enrichment analysis and gene set enrichment analysis. Symbol gene IDs were first converted to Entrez gene IDs using the clusterProfiler 39 package. Pathway enrichment analysis and GSEA 40,41 were implemented using the ReactomePA 42 package. Pathway enrichment analysis was done on genes taken from the different modules in the SOMs. GSEA was done using the differentially expressed genes inferred by the diffexpnb function from the RaceID package.

Immunofluorescence. Human liver tissue was fixed overnight in 3.7% formaldehyde (Fig. 3g) or cryosectioned and fixed in 2.5% paraformaldehyde for 20 min (Extended Data Fig. 7e). The tissue was embedded in OCT and stored at -80 °C. The tissue was cryosectioned into 7µ m sections. The tissue was washed twice for 5 min in 0.025% Triton 1 × PBS. The tissue was then blocked in 10% FBS with 1% BSA in 1 × PBS for 2 h at room temperature. The dilution used for the antihuman KRT19 (HPA002465, Sigma, Fig. 3g; MA5-12663, Invitrogen, Extended Data Fig. 7e) and EPCAM (SAB4200704, Sigma, Fig. 3g; PA5-19832, Invitrogen, Extended Data Fig. 7e) antibodies was 1:100 in 100 µ l 1 × PBS with 1% BSA. The antibodies were incubated overnight at 4 °C in the dark. The tissue was washed twice with 0.025% Triton 1 × PBS and then incubated with secondary antibodies donkey anti-rabbit IgG-AF488 ((A21206, Thermo Fisher Scientific), Fig. 3g) and goat anti-mouse IgG-AF568 ((A11019, Thermo Fisher Scientific), Fig. 3g) or sheep anti-mouse IgG-AF488 ((515-545-062, Jackson ImmunoResearch), Extended Data Fig. 7e) at 1:200 dilution and donkey anti-rabbit IgG-RRX ((711-295-152, Jackson ImmunoResearch), Extended Data Fig. 7e) at 1:100 dilution in 1 × PBS with 1% BSA for 1 h at room temperature. The tissue was then washed twice with 0.025% Triton 1 × PBS. DAPI Fluoromount-G (Southern Biotech) was added to the tissue and a coverslip placed on top. Imaging was done using a Zeiss confocal microscope LSM780 (Fig. 3g) or ZEISS Axio Vert.A1 (Extended Data Fig. 7e). Images were taken at 63 × magnification.

Organoid culturing. Organoid culturing was done as previously described 43 . The cell populations from the EPCAM + compartment were sorted on an Aria Fusion I using a 100µ m nozzle into tubes containing culture medium supplemented with 10 µ M ROCK inhibitor (Y-27632) (Sigma-Aldrich). After sorting, cells were centrifuged in order to remove the medium and then resuspended in 25 µ l Matrigel. Droplets of the Matrigel solution containing the cells were added to the wells of a 24-well suspension plate and incubated for 5-10 min at 37 °C until the Matrigel solidified. Droplets were overlaid with 250 µ l liver isolation medium and then incubated at 37 °C, 5% CO2. After 3-4 days, the liver isolation medium was replaced with liver expansion medium. For the single-cell culture, from each patient, single cells from the TROP2 int gate were sorted into the wells of a non-tissue-culture-treated 96-well plate containing medium with 5% Matrigel. Organoids were passaged 14 days after isolation and then passaged multiple times 5-7 days after splitting. For FACS, single-cell suspensions were prepared from the organoids by mechanical dissociation followed by TrypLE (Life Technologies) digestion as previously described 43 . Organoid cells were sequenced 5 days after splitting and 17 days after initially sorting the cells for the culture.

## Data availability

Data generated during this study have been deposited in the Gene Expression Omnibus (GEO) with the accession code GSE124395. The human liver cell atlas can be interactively explored at http://human-liver-cell-atlas.ie-freiburg. mpg.de/.

Acknowledgements This study was supported by the Max Planck Society, the German Research Foundation (DFG) (SPP1937 GR4980/1-1, GR4980/3-1, and GRK2344 MeInBio), the DFG under Germany's Excellence Strategy (CIBSS - EXC-2189 - Project ID 390939984), and the Behrens-WeiseFoundation (all to D.G.); and by ARC, Paris and Institut Hospital-Universitaire, Strasbourg (TheraHCC, TheraHCC2.0 IHUARC IHU201301187 and IHUARC2019 IHU201901299 to T.F.B.), the European Union (ERC-AdG2014-671231-HEPCIR, EU H2020-667273-HEPCAR and ERC-PoC-2016PRELICAN to T.F.B), Agence nationale de recherches sur le sida et les hépatites virales (ANRS, ECTZ35076) and the Foundation of the University of Strasbourg. This work was done under the framework of the LABEX ANR10-LABX-0028\_HEPSYS and Inserm Plan Cancer (Plan Cancer 20142019, Action 13.1, appel à projets 2018) and benefits from funding from the state managed by the French National Research Agency as part of the Investments for the future. Institut Universitaire France (IUF) to T.F.B. We thank S. Hobitz, K. Schuldes (MPI-IE FACS facility) and U. Bönisch (MPI-IE Deep Sequencing facility); the CRB (Centre de Ressources BiologiquesBiological Resource Centre of the Strasbourg University Hospitals) for the management of regulatory requirements of patient-derived liver tissue; C. Fauvelle and L. Heydmann for their contributions to the initial single-cell isolations; F. Juehling, F. H. T. Duong and C. Schuster for helpful discussions; the patients for providing informed consent to participate in the study; and the nurses, technicians and medical doctors of the hepatobiliary surgery and pathology services of Strasbourg University Hospitals for their support. This publication is part of the Human Cell Atlas (https://www.humancellatlas.org/ publications).

Author contributions T.F .B. and D.G. conceived the study. N.A. designed, optimized and performed cell sorting, scRNA-seq, organoid culture and immunofluorescence, provided validation using the Human Protein Atlas, and performed computational analysis and interpretation of the data. A.S. managed the supply of patient material, isolated single cells from patient tissue, performed animal experiments and carried out immunofluorescence. S. contributed to scRNA-seq analyses and performed scRNA-seq experiments. L.M. performed animal experiments. J.S.H. created the web interface. S.D. isolated single cells from patient tissues. P .P . performed liver resections and provided patient liver samples. T.F.B. established the liver tissue supply pipeline and supervised the animal experiments. D.G. analysed and interpreted the data and supervised experiments and analysis by N.A., S. and J.S.H. D.G., N.A. and T.F.B. coordinated and led the study. N.A. and D.G. wrote the manuscript with input from S., A.S. and T.F.B.

expressed genes (Benjamini-Hochberg corrected P &lt; 0.01; see Methods) between fresh and cryopreserved cells within each cluster for patient 325 (top; n = 2,248 cells) and patients 304 ( n = 959 cells) and 301 ( n = 1,329 cells) (bottom). Only clusters with more than five cells from fresh and cryopreserved samples were included for the computation. g , Scatter plot of mean normalized expression across fresh and cryopreserved cells from patient 325 in endothelial cells of cluster 10 (no differentially expressed genes, left; n = 101 cells) and cluster 11 (maximal number of differentially expressed genes across all clusters, right; n = 272 cells). Red dots indicate differentially expressed genes (Benjamini-Hochberg corrected P &lt; 0.01; see Methods). Diagonal (solid black line) and log2 fold changes of 4 (broken black lines) are indicated. Almost all differentially expressed genes for cluster 11 exhibit log2 fold changes of less than 4. h , Bar plot showing the fraction of sorted cells which passed quality filtering (see Methods) after scRNA-seq. Error bars are derived from the sampling error assuming binomial counting statistics. F, fresh samples; C, cryopreserved samples. i , t -SNE map highlighting cells sequenced from mixed plates representing unbiased samples for patients 301 and 304. Without any enrichment strategy, hepatocytes and immune cells strongly dominate and endothelial cells and EPCAM + cells are rarely sequenced. j , Table of patient information. CCM, colon cancer metastasis; ICC, intrahepatic cholangiocarcinoma; LR, liver resection.

either indicate the presence of doublets or be due to spillover of highly expressed genes such as ALB between cells during library preparation. For the zonation analysis (Fig. 2), only cells in clusters 3, 7, 19, 4, 2, 9, 8 and 11 from the map in e were included. e , f , n = 3,040 cells. g , Immunostaining for the periportal markers CPS1, PCK1, MTHFS, and GATM from the Human Protein Atlas 31 . The zonation module containing each gene in the SOM (Fig. 2a) is indicated in parentheses. P, portal tracts; C, central veins. h , Pathways enriched for genes in hepatocyte central/mid modules 24 and 33 (top; n = 659 genes) and periportal modules 1 and 3 (bottom; n = 422 genes) (compare with Fig. 2a). i , Immunostaining of the central marker ENG from the Human Protein Atlas 31 . The zonation module in the SOM (Fig. 2b) is indicated in parentheses. j , Pathways enriched for genes in endothelial central/mid modules 1 and 3 (top; n = 422 genes) and periportal module 20 (bottom; n = 73 genes) (compare with Fig. 2b). h , j , P values in the pathway enrichment analysis were calculated using a hypergeometric model and adjusted using the Benjamini-Hochberg method (see Methods). k , Pearson's correlation coefficient of hepatocyte zonation profiles of orthologue pairs of human and mouse genes. Mouse data are from Halpern et al. 9 ( n = 967 genes) l , Pearson's correlation coefficient of endothelial cell (including MVECs and LSECs) zonation profiles of orthologue pairs of human and mouse genes ( n = 977 genes). Mouse data are from Halpern et al. 13 . See Methods for details.

Extended Data Fig. 7 | scRNA-seq identifies marker genes expressed by EPCAM + cells. a , Expression t -SNE maps (left) for EPCAM , CD24 , FGFR2 , TACSTD2 , CLDN1 , TM4SF4 , WWTR1 and ANXA4 ( n = 10,372 cells) and immunohistochemistry from the Human Protein Atlas (right) for CLDN1, TM4SF4, WWTR1, and ANXA4. b , Expression t -SNE maps for ASGR1 and CFTR ( n = 10,372 cells). c , t -SNE maps showing expression of KRT19, ALB , TACSTD2 and MUC6 in the EPCAM + compartment ( n = 1,087 cells). a -c , Colour bars indicate log2 normalized expression. d , Expression heat map of proliferation marker genes ( MKI67 , PCNA ), AFP , and identified markers of the EPCAM + compartment.

Genes highlighted in red correspond to newly identified markers of the EPCAM + compartment. The heat map comprises all clusters to show the specificity of the markers for the progenitor compartment. The expression analysis confirms the absence of proliferating and AFP + cells. e , Immunofluorescence labelling of EPCAM and KRT19 on human liver tissue. EPCAM + KRT19 low/cells (solid arrow) in the canals of Hering (asterisk) and EPCAM + KRT19 + cells (broken arrow) in the bile duct (arrowhead) are indicated. Nuclei are stained with DAPI. Scale bar, 10 µ m ( n = 3 independent experiments).

Extended Data Fig. 8 | The EPCAM + compartment segregates into different major subpopulations. a , Separate RaceID3 and StemID2 analyses of the EPCAM + and hepatocyte populations reveal a lineage tree connecting EPCAM + cells to mature hepatocytes via an EPCAM + hepatocyte progenitor cluster (part of the EPCAM + population in Fig. 3b). Shown are links with StemID2 P &lt; 0.05. The node colour highlights transcriptome entropy. b , Two-dimensional diffusion map representation of the population shown in a , highlighting expression of the hepatocyte marker ALB (left), EPCAM (centre), and the mature cholangiocyte marker CFTR (right). The maps suggest continuous transitions from the EPCAM + compartment towards hepatocytes and mature cholangiocytes. c , Expression t -SNE map of EPCAM (top) and the hepatocyte marker ASGR1 (bottom) for the population shown in a . Colour bars indicate log2 normalized expression. b , c , n = 3,877 cells. d , Expression heat map of de novo identified markers of the EPCAM + compartment, highlighting the expression distribution within clusters of this population only (Fig. 3). e , Expression heat map of all genes that were differentially expressed in the more mature clusters, belonging to the groups denoted as 'hepatocyte fate' and 'cholangiocyte fate' . For each of these clusters, the top ten upregulated genes (Benjamini-Hochberg corrected P &lt; 0.01) were selected, and the joint set of these genes is shown in the figure. f , Expression t -SNE maps of CXCL8 , MMP7 and HP . Colour bars indicate log2 normalized expression. d -f , n = 1,087 cells. g , Normalized expression counts of ALB , KRT19 and TACSTD2 in cells sequenced from the gates in Fig. 4a (n = 293 cells). Centre line, mean; boxes, interquartile range; whiskers, 5% and 95% quantiles; data points, outliers. h , t -SNE map of RaceID3 clusters for organoid cells and EPCAM + cells from patients (Fig. 3), including cells sorted from the gates in a . i , Expression t -SNE maps of EPCAM , CD24 and AQP1 in organoid cells and EPCAM + cells from patients. j , Expression t -SNE maps of SFRP5 , ALB , AGR2 and MKI67 . Colour bars indicate log2 normalized expression. h -j , n = 2,870 cells. k , GSEA of genes that are differentially expressed between organoid and EPCAM + liver cells from patients (Benjamini-Hochberg corrected P &lt; 0.01, n = 11,610 genes; see Methods).

clusters. Benjamini-Hochberg corrected P &lt; 0.05; log2 fold change &gt; 1.5; n = 1,936 cells; see Methods). Genes highlighted in red correspond to differentially expressed genes validated by immunohistochemistry. g , Immunostaining of CD34, LAMB1, AQP1 and PLVAP in normal liver and HCC tissues from the Human Protein Atlas. h , Heat map of genes that are differentially expressed between normal and HCC-resident NK and NKT cells (Benjamini-Hochberg corrected P &lt; 0.05; n = 2,754 cells; see Methods). i , Heat map of genes that are differentially expressed between normal and HCC-resident Kupffer cells (Benjamini-Hochberg corrected P &lt; 0.05; n = 991 cells; see Methods). j , GSEA of genes that are differentially expressed between normal and HCC-resident NK and NKT cells ( n = 15,442 genes). k , GSEA of genes that are differentially expressed between normal and HCC-resident Kupffer cells ( n = 15,442 genes).

## Reporting Summary

Nature Research wishes to improve the reproducibility of the work that we publish. This form provides structure for consistency and transparency in reporting. For further information on Nature Research policies, see Authors &amp; Referees and the Editorial Policy Checklist.

## Statistical parameters

When statistical analyses are reported, confirm that the following items are present in the relevant location (e.g. figure legend, table legend, main text, or Methods section).

## Software and code

## Field-specific reporting

## Life sciences study design

No exclusion was applied to the raw data. For the final count matrix, prior to normalization of single-cell RNA-seq data, cells expressing &gt;2% of Kcnq1ot1 transcripts, a previously identified marker of low quality cells were excluded from the analysis. Moreover, transcripts correlating to Kcnq1ot1 with a Pearson's correlation coefficient &gt;0.65 were also removed as detailed in the Methods.

Blinding was not used. Normal liver material and HCC material were used in the study ,and measurement and data did not require subjective judgement from the investigators.

## Reporting for specific materials, systems and methods

## Unique biological materials

Human liver tissue samples were obtained from patients who had undergone liver resections between 2015 and 2018 at the Center for Digestive and Liver Disease (Pôle Hépato-digestif) of the Strasbourg University Hospitals University of Strasbourg, France. For the human liver cell atlas, samples were acquired from patients without chronic liver disease (defined as liver damage lasting over a period of at least six months), genetic hemochromatosis with homozygote C282Y mutation, active alcohol consumption (&gt; 20 g/d in women and &gt; 30 g/d in men), active infectious disease, pregnancy or any contraindication for liver

## Antibodies

CD45 (Biolegend, Cat 304023 Clone HI30 Lot B253585 diluton 1:100), PECAM1 (Biolgend, Cat 303111 Clone WM59 Lot B230255, dilution 1:100), CD34 (Biolegend, Cat 343609 Clone 561 Lot B226708, dilution 1:00), CLEC4G (R&amp;D systems, Cat FAB2947A Clone #845404 Lot ADXG0117051, dilution 1:00), ASGR1 (BD Biosciences, Cat 563655 Clone 8D7 Lot 8101863, dilution 1:100), EPCAM (R&amp;D systems, Cat FAB960R Lot AETV0117121, dilution 1:50), and TROP2 (Biolegend, Cat 363803 Clone NY18 Lot B213566, dilution 1:50),  KRT19 (HPA002465 Lot A104888, Sigma, dilution 1:100), EPCAM (SAB4200704 Clone Ber-EP4, monoclonal Lot 046M4864, Sigma, dilution 1:100), donkey anti-rabbit IgG-AF488 (A21206 Lot 2045215, Thermo Fisher Scientific, dilution 1:200), goat anti-mouse IgG-AF568 (A11019 Lot 1841756, dilution 1:200).

## Animals and other organisms

## Human research participants

The study enrolled biomaterials from 9 patients without chronic liver disease; the patients were 5 M and 4 F with age ranging from 34 to 77 yrs old and underwent liver resection for colon cancer metastatis (n=8) and intrahepatic cholangiocarcinoma (n=1). The resected tissue distant from the tumor was used. The study also involved biomaterial from 3 patients (1 M and 2 F, age 65-71 yrs old) affected by hepatocellular carcinoma who underwent surgical tumor resection.

## Flow Cytometry

## Methodology

FSC/SSC gates excluded cells with very low FSC and were set to include populations of different sizes and morphologies and big enough so as not to exclude any liver cell populations. Only single cells were gated from this gate by gating out doublets based on FSC-H/FSC-W and SCC-H/SSC-W. Viable cells that had a negative signal for the zombie green dye were then gated on. Positive signals for the viability dye and the antibodies against the markers were determined after comparing to an unstained samples and samples stained only with the viability dye which was gated on viable cells.